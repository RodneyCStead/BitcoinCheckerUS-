<!-- Practice questions for March 18th -->
<!-- Written by: Rodney Stead -->
<!-- Note: I know the error and success were not needed, but wanted to do for practice. -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Current value Viewer</title>
    <style>
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 16px;
        }
        #bitcoinValue {
            font-size: 20px;
            font-weight: bold;
            padding: 15px;
            border: 5px solid black;
            width: 50%;
            border-radius: 16px;

        }

        #success {
            background-color: lightgreen;
            width: 50%;
            border: 2px solid black;
            font-size: 16px;
            font-weight: bold;
            padding: 15px;
        }
        #error {
            background-color: lightcoral;
            width: 50%;
            border: 2px solid black; 
            font-size: 16px;
            font-weight: bold; 
            padding: 15px;  
        }
    </style>
</head>
<body>
    <button class = "button" onclick = "getCurrentValue()">
        Click for current value
    </button>
    <p id = "bitcoinValue"></p>
    <script>
        function updateValues(newValue) {
    document.getElementById('bitcoinValue').innerText = "Current Bitcoin value: " + newValue;

    var successElement = document.createElement('div');
    successElement.id = 'success';
    successElement.innerText = "The value has been updated successfully!";
    document.body.appendChild(successElement);

    // Clears the success message
    setTimeout(function() {
        successElement.remove();
    }, 5000);

    // Updates the Bitcoin value every minute
    setTimeout(getCurrentValue, 60000);
}

function getCurrentValue () {
    var xhr = new XMLHttpRequest();
    var url = "https://blockchain.info/q/24hrprice";
    var errorElement = null;
    
    xhr.onload = function () {
        var response = this.responseText;
        var currentValue = `${response} (USD)`; 
        updateValues(currentValue);
    };
    
    xhr.onerror = function() {
        errorElement = document.createElement('div');
        errorElement.id = 'error';
        errorElement.innerText = "Error fetching data.";
        document.body.appendChild(errorElement);

        // Clears the error message
        setTimeout(function() {
            if (errorElement) {
                errorElement.remove();
            }
        }, 5000);
    };

    xhr.open ("GET", url);
    xhr.send();
}

window.onload = function() {
    getCurrentValue();
}
    </script>
</body>
</html>